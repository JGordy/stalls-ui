os: osx
language: node_js
node_js: 
  - "8"
cache:
  directories:
    - node_modules
script: 
  - npm install
  - npm run build
  - npm test
notifications:
  slack: generositymarket:ZeAVzH5Ww7PB50ugNnwl5JuT

# build dist for npm publishing
before_deploy:
  - npm run build:publish

#Deployment information
deploy:
  # Deploy to npm registry
  - provider: npm
    email: "$NPM_EMAIL"
    api_key: "$NPM_TOKEN"
    skip_cleanup: true
    on:
      tags: true

  # deploy master storybook to production
  - provider: pages # Github Pages
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    local_dir: storybook-static # The folder that needs to be deployed
    repo: jgordy/stalls-ui
    target_branch: gh-pages
    on:
      branch: master

  # - provider: script
  #   script: npm run deploy-storybook
  #   on:
  #     branch: master

# Deployment information
# deploy:
#   provider: pages
#   github_token: $github_token
#   skip_cleanup: true
#   local_dir: build
#   on:
#     branch: master